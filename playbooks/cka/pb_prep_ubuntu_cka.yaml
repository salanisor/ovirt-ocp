---
- hosts: cluster
  become: true
  gather_facts: false
  vars:
    input: "{{ lookup('template', '/etc/fstab') }}"
    repline: "{{ input | regex_search('^\\/swap\\.img.*$') }}"
  tasks:
  #/swap.img	none	swap	sw	0	0
  - name: "Comment out swap mount"
    replace:
      path: /etc/fstab
      regexp: '^\/swap\.img.*$'
      replace: ""
      backup: yes
  #- name: "Installed required packages"
  #  apt:
  #    pkg:
  #      - git
  #    state: latest
  - name: "Copy required files"
    copy:
      src: "{{item}}"
      dest: "/usr/local/bin/{{item}}"
      mode: '0555'
    with_items:
      - setup-container.sh
      - setup-kubetools-ubuntu.sh
  - name: "Run setup-container"
    command:
      cmd: "/usr/local/bin/setup-container.sh"
  - name: "Run kubetools-ubuntu"
    command:
      cmd: "/usr/local/bin/setup-kubetools-ubuntu.sh"
